<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace 指定的是映射接口的完整路劲名 -->
<mapper namespace="cfw.movies.mapper.MoviesMapper">
	<!-- Insert a movie must with its full information. -->
	<insert id="insertOne" parameterType="Movies">
		INSERT INTO 
			movies(
				name,
				type,
				record_time,
				did,
				pic,
				score
			) 
		VALUES(
			#{name},
			#{type},
			NOW(),
			#{description.id},
			#{pic},
			#{score}
		)
	</insert>
	
	<select id="selectMovies" parameterType="Map" resultType="Movies">
		SELECT
			id,
			name,
			type,
			score
		FROM
			movies
		<choose>
			<when test="start != null and length != null">
				LIMIT #{start},#{length}
			</when>
			<otherwise>
				LIMIT 0,20
			</otherwise>
		</choose>
	</select>
	
	<!-- 2016.04.24 19:04 -->
	<resultMap type="Movies" id="fullMovieMap">
		<constructor>
			<idArg column="id" javaType="Long"/>
			<arg column="name" javaType="String"/>
			<arg column="type" javaType="String"/>
			<arg column="pic" javaType="String"/> 
			<arg column="score" javaType="Float"/>
		</constructor>
		<association property="description" javaType="Descriptions">
			<id property="id" column="did"/>
			<result property="description" column="description"/>
		</association>
	</resultMap>
	<select id="selectFullMovies" parameterType="Map" resultMap="fullMovieMap">
		SELECT
			m.id,
			m.name,
			m.type,
			m.pic,
			m.score,
			d.id as did,
			d.description
		FROM
			movies m,
			descriptions d
		WHERE
			d.id = m.did
		<choose>
			<when test="start != null and length != null">
				LIMIT #{start},#{length}
			</when>
			<otherwise>
				LIMIT 0,20
			</otherwise>
		</choose>
	</select>
	
	<!-- 2016.04.24 21:54 -->
	<select id="selectCount" resultType="Long">
		SELECT
			count(id)
		FROM 
			movies
	</select>
</mapper>